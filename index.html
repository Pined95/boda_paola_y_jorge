<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boda Paola & Jorge</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Montserrat:wght@300;400;600&family=Dancing+Script:wght@600&display=swap" rel="stylesheet">
    
    <style>
        :root { --accent: #B8860B; --bg: #F9F9F7; --text: #333; --light: #fff; }
        * { box-sizing: border-box; }
        body { background: #eee; font-family: 'Montserrat', sans-serif; margin: 0; color: var(--text); }
        .app { max-width: 480px; margin: 0 auto; background: var(--bg); min-height: 100vh; box-shadow: 0 0 20px rgba(0,0,0,0.1); padding-bottom: 60px; }
        
        /* --- HEADER --- */
        .hero { height: 350px; background: url('https://images.unsplash.com/photo-1511285560982-1356c11d4606?auto=format&fit=crop&w=800&q=80') center/cover; position: relative; }
        .hero::after { content: ''; position: absolute; bottom: 0; width: 100%; height: 150px; background: linear-gradient(to top, var(--bg), transparent); }
        .titles { position: absolute; bottom: 30px; width: 100%; text-align: center; z-index: 2; }
        h1 { font-family: 'Cinzel', serif; color: var(--accent); margin: 0; font-size: 2.8rem; text-shadow: 0 2px 10px rgba(255,255,255,0.8); }
        .subtitle { letter-spacing: 3px; font-size: 0.9rem; font-weight: 600; margin-top: 5px; }

        /* --- CONTENEDOR Y CARDS --- */
        .container { padding: 20px; margin-top: -20px; position: relative; z-index: 3; }
        .card { background: var(--light); border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.03); text-align: center; }
        .section-title { font-family: 'Cinzel', serif; color: var(--accent); font-size: 1.4rem; margin-bottom: 15px; position: relative; display: inline-block; }
        .section-title::after { content: ''; display: block; width: 40px; height: 2px; background: var(--accent); margin: 5px auto 0; }

        /* --- MENSAJE PERSONAL --- */
        .personal-note { font-family: 'Dancing Script', cursive; font-size: 1.5rem; color: #555; background: #fffdf0; border: 1px solid #f0e6d2; padding: 15px; border-radius: 8px; margin-top: 15px; transform: rotate(-1deg); display: none; }

        /* --- TIMELINE --- */
        .timeline-item { display: flex; align-items: center; margin-bottom: 15px; text-align: left; }
        .time { font-weight: bold; color: var(--accent); width: 70px; text-align: right; margin-right: 15px; font-size: 0.9rem; }
        .event { font-size: 0.95rem; }
        .icon { font-size: 1.2rem; margin-right: 10px; }

        /* --- DRESS CODE --- */
        .dress-icons { display: flex; justify-content: center; gap: 20px; margin: 15px 0; }
        .dress-item { font-size: 0.8rem; color: #666; }
        .dress-icon { font-size: 2rem; display: block; margin-bottom: 5px; }

        /* --- REGALOS --- */
        .gift-btn { display: block; width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 8px; text-decoration: none; color: #333; font-weight: 600; transition: 0.2s; background: #fff; }
        .gift-btn:hover { background: #f9f9f9; border-color: var(--accent); }

        /* --- RSVP --- */
        .guest-item { border-bottom: 1px solid #f5f5f5; padding-bottom: 15px; margin-bottom: 15px; text-align: left; }
        .toggle-group { display: flex; gap: 10px; margin-top: 8px; }
        .toggle-btn { flex: 1; padding: 10px; border: 1px solid #eee; border-radius: 6px; background: white; cursor: pointer; text-align: center; font-size: 0.85rem; }
        .toggle-btn.selected { background: var(--accent); color: white; border-color: var(--accent); }
        .toggle-btn.reject.selected { background: #d32f2f; border-color: #d32f2f; }
        
        .cta-btn { width: 100%; padding: 16px; background: var(--accent); color: white; border: none; border-radius: 50px; font-size: 1rem; font-family: 'Cinzel', serif; cursor: pointer; box-shadow: 0 4px 15px rgba(184,134,11,0.3); margin-top: 10px; }
        .cta-btn:disabled { background: #ccc; box-shadow: none; }

        /* --- QR --- */
        .qr-img { width: 200px; height: 200px; margin: 15px auto; background: #eee; }
        
        .hidden { display: none; }
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 100; display: flex; justify-content: center; align-items: center; flex-direction: column; }
    </style>
</head>
<body>

<div id="loader"><p style="letter-spacing: 2px;">CARGANDO...</p></div>

<div class="app">
    <div class="hero">
        <div class="titles">
            <h1>Paola & Jorge</h1>
            <div class="subtitle">14 DE MARZO, 2026</div>
        </div>
    </div>

    <div class="container">
        
        <div class="card">
            <p style="color:#999; font-size:0.8rem;">ESTIMADA</p>
            <h2 id="main-guest-name" style="margin: 5px 0; font-family: 'Cinzel', serif;">Familia</h2>
            <div id="personal-msg-box" class="personal-note"></div>
            <p style="margin-top:15px; font-size:0.9rem; color:#666;">Queremos que sean parte de nuestro gran d铆a.</p>
        </div>

        <div class="card">
            <h3 class="section-title">Itinerario</h3>
            <div class="timeline-item"><div class="time">4:00 PM</div><div class="event"><span class="icon"></span>Ceremonia Religiosa</div></div>
            <div class="timeline-item"><div class="time">8:00 PM</div><div class="event"><span class="icon"></span>Recepci贸n y Cena</div></div>
            <div class="timeline-item"><div class="time">9:30 PM</div><div class="event"><span class="icon"></span>Fiesta</div></div>
            
            <button class="gift-btn" style="margin-top:15px; background:#333; color:#fff;" onclick="window.open('https://calendar.google.com/calendar/render?action=TEMPLATE&text=Boda+Paola+y+Jorge&dates=20260314T160000/20260314T235900', '_blank')"> Agendar en Google Calendar</button>
            <button class="gift-btn" onclick="window.open('https://goo.gl/maps/TU_LINK', '_blank')"> Ver Ubicaci贸n en Mapa</button>
        </div>

        <div class="card">
            <h3 class="section-title">C贸digo de Vestimenta</h3>
            <p style="font-weight:bold; color:#555;">FORMAL RIGUROSO</p>
            <div class="dress-icons">
                <div class="dress-item"><span class="dress-icon"></span>Vestido Largo</div>
                <div class="dress-item"><span class="dress-icon">さ</span>Traje Oscuro</div>
            </div>
            <p style="font-size:0.8rem; color:#999;">Reservado el color blanco para la novia.</p>
        </div>

        <div class="card">
            <h3 class="section-title">Mesa de Regalos</h3>
            <p style="font-size:0.9rem; margin-bottom:15px;">Su presencia es nuestro mejor regalo. Si desean tener un detalle con nosotros:</p>
            <a href="#" class="gift-btn"> Liverpool (Evento: 12345)</a>
            <a href="#" class="gift-btn"> Amazon</a>
            <div style="margin-top:10px; font-size:0.85rem; color:#666;">锔 Lluvia de sobres en recepci贸n</div>
        </div>

        <div id="rsvp-section" class="card">
            <h3 class="section-title">Confirmaci贸n</h3>
            <div style="background:#fff5f5; color:#c62828; padding:10px; border-radius:5px; font-size:0.8rem; margin-bottom:15px;">Evento Solo Adultos</div>
            
            <div id="guests-list"></div>
            
            <div style="text-align:left; margin-top:20px;">
                <label style="font-size:0.9rem; font-weight:bold;"> 驴Qu茅 canci贸n no puede faltar?</label>
                <input type="text" id="song-suggestion" placeholder="Escribe tu canci贸n favorita..." style="width:100%; padding:10px; margin-top:5px; border:1px solid #ddd; border-radius:5px;">
            </div>

            <button class="cta-btn" onclick="sendRSVP()">CONFIRMAR ASISTENCIA</button>
        </div>

        <div id="ticket-section" class="card hidden">
            <h3 class="section-title">隆Confirmado!</h3>
            <p style="font-size:0.9rem;">Este es el pase de acceso para tu grupo.</p>
            <div id="qr-placeholder" class="qr-img"></div>
            <p style="font-size:0.8rem; color:#888; margin-top:10px;">Por favor toma una captura de pantalla.</p>
        </div>

    </div>
</div>

<script>
    //  PEGA TU URL AQU
    const API_URL = "https://script.google.com/macros/s/AKfycbwKHuUxgylzWt0OWHpimxtCFHGFWF87EsK6uaKoN9VlZfmEDgQMZYRePLZhT4AQbDXF/exec"; 

    const params = new URLSearchParams(window.location.search);
    const userId = params.get('id');
    let groupData = [];

    window.onload = async () => {
        if(!userId) { 
            document.getElementById('loader').style.display = 'none'; 
            document.querySelector('.container').innerHTML = "<div class='card'><h3>Link incompleto</h3></div>"; return; 
        }
        try {
            const res = await fetch(`${API_URL}?action=getInvite&id=${userId}`);
            const data = await res.json();
            document.getElementById('loader').style.display = 'none';

            if(data.status === 'success') {
                document.getElementById('main-guest-name').textContent = data.mainName;
                if(data.personalMsg) {
                    const box = document.getElementById('personal-msg-box');
                    box.textContent = `"${data.personalMsg}"`;
                    box.style.display = 'block';
                }
                groupData = data.members;
                renderList(data.members);
                // Auto mostrar QR si ya confirmaron todos (opcional)
                // if(data.members.some(m => m.estado && m.estado.includes('SI'))) showQR();
            }
        } catch(e) { alert("Error de conexi贸n"); document.getElementById('loader').style.display = 'none'; }
    };

    function renderList(members) {
        const list = document.getElementById('guests-list');
        list.innerHTML = '';
        members.forEach((m, i) => {
            const isYes = m.estado && (m.estado.includes('SI') || m.estado.includes('CONFIRMADO'));
            const isNo = m.estado && (m.estado.includes('NO') || m.estado.includes('DECLINADO'));
            // Mostrar mesa si existe
            const table = (isYes && m.mesa && m.mesa !== "Por asignar") ? `<br><span style="font-size:0.8rem; color:var(--accent);"> ${m.mesa}</span>` : '';

            list.innerHTML += `
                <div class="guest-item">
                    <div style="font-weight:bold;">${m.nombre} ${table}</div>
                    <div class="toggle-group">
                        <div class="toggle-btn ${isYes?'selected':''}" onclick="setSt(${i},'SI',this)">Asistir茅</div>
                        <div class="toggle-btn reject ${isNo?'selected':''}" onclick="setSt(${i},'NO',this)">No podr茅</div>
                    </div>
                    <input id="al-${i}" placeholder="驴Alergias?" style="width:100%; margin-top:5px; padding:8px; display:${isYes?'block':'none'}; border:1px solid #eee;" value="${m.alergias||''}">
                </div>`;
        });
    }

    function setSt(i, s, btn) {
        groupData[i].estado = s;
        btn.parentElement.querySelectorAll('.toggle-btn').forEach(b=>b.classList.remove('selected'));
        btn.classList.add('selected');
        document.getElementById(`al-${i}`).style.display = s==='SI'?'block':'none';
    }

    async function sendRSVP() {
        if(groupData.some(m => !m.estado)) if(!confirm("Faltan selecciones. 驴Enviar as铆?")) return;
        
        const btn = document.querySelector('.cta-btn');
        btn.innerText = "ENVIANDO..."; btn.disabled = true;

        const responses = groupData.map((m, i) => ({
            id: m.id, rsvp: m.estado||'PENDIENTE', alergias: document.getElementById(`al-${i}`).value
        }));
        const song = document.getElementById('song-suggestion').value;

        await fetch(API_URL, {
            method: 'POST', mode: 'no-cors',
            headers: {'Content-Type': 'text/plain;charset=utf-8'},
            body: JSON.stringify({action: 'RSVP_GROUP', responses, song})
        });
        setTimeout(showQR, 1500);
    }

    function showQR() {
        document.getElementById('rsvp-section').style.display = 'none';
        document.getElementById('ticket-section').classList.remove('hidden');
        document.getElementById('qr-placeholder').innerHTML = `<img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${userId}&color=B8860B" style="width:100%">`;
        window.scrollTo({top:0, behavior:'smooth'});
    }
</script>
</body>
</html>